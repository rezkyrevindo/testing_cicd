install:
- curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.2/install.sh | bash
- export NVM_DIR="$HOME/.nvm" && [ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"
- nvm install stable
- nvm use stable
- nvm alias default stable

- npm install -g react-native-cli
- npm install -g detox-cli
- npm install -g yarn

matrix:
  include:

    - os: linux
      language: android
      jdk: oraclejdk8
      sudo: required
      android:
        components:
          - platform-tools
          - tools
          - build-tools-29.0.2
          - android-29
          - extra-android-m2repository
          - extra-google-google_play_services
          - extra-google-m2repository
      licenses:
        - android-sdk-preview-license-.+
        - android-sdk-license-.+
        - google-gdk-license-.+
      before_script:
        # Prepare pre-accepted licenses to not be promted at installation
        - yes | sdkmanager "platforms;android-27"
        - chmod +x ./android/gradlew
      script:
        - cd android
      after_script:
        - ./gradlew assembleRelease

      deploy:
        provider: releases
        api-key: $GITHUB_API_KEY
        file: $TRAVIS_BUILD_DIR/android/app/build/outputs/apk/release/app-release.apk
        skip_cleanup: true
        name: dev-build-$TRAVIS_TAG
        body: Automatic build of $TRAVIS_BRANCH ($TRAVIS_COMMIT) built by Travis CI on $(date +'%F %T %Z').
        prerelease: true
        overwrite: true
        target_commitish: $TRAVIS_COMMIT
        on:
          tags: true

      after_deploy:
        - rm -rf $TRAVIS_BUILD_DIR/android/app/build/outputs

