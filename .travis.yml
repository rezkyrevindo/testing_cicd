language: android
before_install: #1.1
- nvm install stable
- node --version
install: #1.2
- npm install
android: #1.3
  components:
  - build-tools-29.0.2
  - android-29
  - extra-android-m2repository
  - extra-google-google_play_services
  - extra-google-m2repository
  - addon-google_apis-google-16
script: 
- npm run ci #2
- cd android && ./gradlew assembleRelease #3
deploy:
  provider: releases
  api-key: $GITHUB_API_KEY
  file: $TRAVIS_BUILD_DIR/android/app/build/outputs/apk/release/app-release.apk
  skip_cleanup: true
  name: dev-build-$TRAVIS_TAG
  body: Automatic build of $TRAVIS_BRANCH ($TRAVIS_COMMIT) built by Travis CI on $(date +'%F %T %Z').
  prerelease: true
  overwrite: true
  target_commitish: $TRAVIS_COMMIT
  on:
    tags: true

after_deploy:
  - rm -rf $TRAVIS_BUILD_DIR/android/app/build/outputs

